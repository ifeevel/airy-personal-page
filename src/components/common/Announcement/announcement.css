/* 
 * 全局公告组件 (Announcement System)
 * 采用 Glassmorphism (玻璃拟态) 设计风格
 * 逻辑优先级：布局容器 > 核心条目 > 文本层级 > 交互元素 > 动画 > 响应式
 */

/* ==========================================================================
   1. 布局容器 (Outer Container)
   ========================================================================== */
.announcement-container {
    position: fixed;
    top: 1.5rem;
    left: 50%;
    transform: translateX(-50%);
    width: 90%;
    max-width: 50rem;
    display: flex;
    flex-direction: column;
    /* 采用 margin-bottom 替代 gap，是为了在退出动画时能平滑坍缩间距 */
    z-index: 1050;
    pointer-events: none; /* 容器不拦截点击，容器内的 item 重新开启 */
}

/* ==========================================================================
   2. 核心条目 (Announcement Item Base)
   ========================================================================== */
.announcement-item {
    pointer-events: auto; /* 开启点击拦截 */
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.875rem 1.5rem;
    margin-bottom: 0.75rem; /* 条目间距 */
    border-radius: 1.25rem;
    
    /* 核心视觉：玻璃拟态 */
    background: rgba(255, 255, 255, 0.55);
    backdrop-filter: var(--glass-blur-deep);
    -webkit-backdrop-filter: var(--glass-blur-deep);
    border: var(--glass-border);
    
    /* 阴影效果 */
    box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.05);
    
    /* 交互属性 */
    transition: transform 0.4s var(--bezier), border-color 0.4s var(--bezier), box-shadow 0.4s var(--bezier);
    animation: announcementIn 0.5s var(--bezier) forwards;
    overflow: hidden; /* 关键：确保高度坍缩动画时内容不溢出 */
    
    /* 语义色默认值 (Info/Blue) */
    --accent-color: #3b82f6;
    --accent-bg: rgba(59, 130, 246, 0.1);
}

/* 条目整体悬停状态：发光 & 微升 */
.announcement-item:hover {
    transform: translateY(-2px);
    border-color: var(--accent-color); /* 1px 极细语义色亮线 */
    box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.1), 
                0 0 12px var(--accent-bg); /* 周围产生微弱发光感 */
}

/* ==========================================================================
   3. 语义化配色 (Semantic Themes)
   ========================================================================== */
[data-type="success"] { --accent-color: #10b981; --accent-bg: rgba(16, 185, 129, 0.1); }
[data-type="info"]    { --accent-color: #3b82f6; --accent-bg: rgba(59, 130, 246, 0.1); }
[data-type="warning"] { --accent-color: #f59e0b; --accent-bg: rgba(245, 158, 11, 0.1); }
[data-type="error"]   { --accent-color: #ef4444; --accent-bg: rgba(239, 68, 68, 0.1); }

/* ==========================================================================
   4. 内容与排版 (Content & Typography)
   ========================================================================== */
.announcement-content {
    display: flex;
    align-items: center; /* 确保图标与多行文字视觉中心靠齐 */
    gap: 1rem;
    flex: 1;
}

/* 图标容器 */
.announcement-icon {
    flex-shrink: 0;
    width: 1.5rem;
    height: 1.5rem;
    color: var(--accent-color);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: color 0.3s var(--bezier);
}
.announcement-icon svg { width: 1.5rem; height: 1.5rem; }

/* 文本容器 */
.announcement-text { display: flex; flex-direction: column; }

/* 标题：0.9375rem (15px)，加粗 */
.announcement-title {
    font-weight: 700;
    font-size: 0.9375rem;
    color: var(--text-primary);
    line-height: 1.4;
}

/* 详情容器：包含描述与日期 */
.announcement-details {
    display: flex;
    align-items: baseline;
    gap: 0.5rem;
    flex-wrap: wrap;
}

/* 描述：0.875rem (14px)，次要色 */
.announcement-description {
    font-size: 0.875rem;
    color: var(--text-secondary);
    line-height: 1.5;
}

/* 日期：0.7rem (11px)，次要色 */
.announcement-date {
    font-size: 0.7rem;
    color: var(--text-secondary);
    opacity: 0.6;
}

/* ==========================================================================
   5. 交互动作 (Actions & Interactive)
   ========================================================================== */
.announcement-actions {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-left: 1rem;
}

/* “了解更多”按钮：0.8125rem (13px) */
.announcement-link {
    font-size: 0.8125rem;
    font-weight: 500;
    color: var(--accent-color) !important; /* 强制覆盖全局链接 hover 色 */
    text-decoration: none !important;
    padding: 0.35rem 0.75rem;
    border-radius: 0.625rem;
    background: var(--accent-bg);
    transition: filter 0.2s var(--bezier), transform 0.2s var(--bezier);
    white-space: nowrap;
}
.announcement-link:hover {
    filter: brightness(0.9);
    transform: scale(1.05);
    color: var(--accent-color) !important;
}

/* 关闭按钮 */
.announcement-close {
    background: transparent;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    padding: 0.25rem;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: background-color 0.2s var(--bezier), color 0.2s var(--bezier), transform 0.2s var(--bezier);
}
.announcement-close:hover {
    background: rgba(0, 0, 0, 0.05);
    color: var(--text-primary);
    transform: rotate(90deg);
}

/* ==========================================================================
   6. 暗黑模式适配 (Dark Mode)
   ========================================================================== */
:root.dark .announcement-item {
    background: var(--glass-bg); /* 降低亮度的深色玻璃 */
    border-color: rgba(255, 255, 255, 0.1);
}
:root.dark .announcement-item:hover {
    box-shadow: 0 20px 35px -5px rgba(0, 0, 0, 0.4), 0 0 15px var(--accent-bg);
    border-color: var(--accent-color);
}
:root.dark .announcement-icon { filter: brightness(0.9) saturate(1.2); }
:root.dark .announcement-close:hover { background: rgba(255, 255, 255, 0.1); }

/* ==========================================================================
   7. 动画定义 (Animations)
   ========================================================================== */
@keyframes announcementIn {
    from { opacity: 0; transform: translateY(-2rem); }
    to { opacity: 1; transform: translateY(0); }
}

/* 丝滑退出动画：包含“淡出”、“位移”以及“物理空间坍缩” */
.announcement-item.is-dismissing { animation: announcementOut 0.5s var(--bezier) forwards; }

@keyframes announcementOut {
    0% {
        opacity: 1;
        transform: translateY(0);
        max-height: 12.5rem;
        margin-bottom: 0.75rem;
        padding-top: 0.875rem; padding-bottom: 0.875rem;
        border-width: 1px;
        visibility: visible;
    }
    30% {
        opacity: 0;
        transform: translateY(-1rem);
        max-height: 12.5rem; /* 暂不缩减高度，先完成淡出 */
        margin-bottom: 0.75rem;
        padding-top: 0.875rem; padding-bottom: 0.875rem;
        border-width: 1px;
    }
    100% {
        opacity: 0;
        transform: translateY(-1rem);
        max-height: 0; /* 物理高度归零 */
        margin-bottom: 0; /* 间距归零，消除跳动 */
        padding-top: 0; padding-bottom: 0;
        border-width: 0;
        visibility: hidden;
        pointer-events: none;
    }
}

/* ==========================================================================
   8. 响应式适配 (Mobile)
   ========================================================================== */
@media (max-width: 48rem) {
    .announcement-container {
        top: 3.25rem;
    }
    .announcement-item {
        flex-direction: column;
        align-items: flex-start;
        padding: 1rem;
    }
    .announcement-actions {
        margin-left: 0;
        width: 100%;
        display: flex;
        justify-content: flex-end; /* 手机端按钮向右对齐 */
    }
    /* 动态控制底部空隙：仅在有按钮时增加间距 */
    .announcement-actions:has(.announcement-link) { margin-top: 0.35rem; }
    .announcement-actions:not(:has(.announcement-link)) { margin-top: 0; height: 0; }
    .announcement-close { position: absolute; top: 0.75rem; right: 0.75rem; }
}

/* ==========================================================================
   9. 减弱动画适配 (Accessibility - Reduced Motion)
   ========================================================================== */
@media (prefers-reduced-motion: reduce) {
    .announcement-item {
        /* 使用简单的透明度变化替代位移动画 */
        animation: fadeInOnly 0.3s ease forwards !important;
        transform: none !important;
    }

    .announcement-item:hover {
        /* 禁用悬停时的 Y 轴位移 */
        transform: none !important;
    }

    .announcement-item.is-dismissing {
        /* 退出时也仅使用透明度变化，不进行位置偏移和高度坍缩动画 */
        animation: fadeOutOnly 0.3s ease forwards !important;
    }

    /* 优化全局过渡时长，使其几乎瞬间完成但保留逻辑连贯性 */
    .announcement-item,
    .announcement-link,
    .announcement-close,
    .announcement-icon {
        transition-duration: 0.01ms !important;
    }

    @keyframes fadeInOnly {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    @keyframes fadeOutOnly {
        from { opacity: 1; }
        to { opacity: 0; }
    }
}
